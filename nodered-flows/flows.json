[{"id":"b7f32e3b.86411","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"e61900e3.71af2","type":"http in","z":"b7f32e3b.86411","name":"beanstalked","url":"/plate","method":"post","upload":true,"swaggerDoc":"","x":70,"y":100,"wires":[["bcf43ef3.d8f25"]]},{"id":"2327afcb.db729","type":"http response","z":"b7f32e3b.86411","name":"","statusCode":"","headers":{},"x":790,"y":100,"wires":[]},{"id":"bcf43ef3.d8f25","type":"function","z":"b7f32e3b.86411","name":"extract","func":"//msg.payload=msg.payload.results[0].plate.flat;\n\nvar plate={};\nplate.registration=msg.payload.results[0].plate;\nmsg.payload=plate;\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":100,"wires":[["7be98cf0.a22844"]]},{"id":"cf50d8a1.36bbd8","type":"debug","z":"b7f32e3b.86411","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":730,"y":20,"wires":[]},{"id":"ccb65d7e.584f3","type":"mongodb2 in","z":"b7f32e3b.86411","service":"_ext_","configNode":"20418120.23251e","name":"find","collection":"RegDb","operation":"findOne","x":490,"y":100,"wires":[["967ebe42.abea3","cf50d8a1.36bbd8"]]},{"id":"7be98cf0.a22844","type":"json","z":"b7f32e3b.86411","name":"","property":"payload","action":"obj","pretty":false,"x":350,"y":100,"wires":[["ccb65d7e.584f3","3c1e387.5da42c8"]]},{"id":"967ebe42.abea3","type":"file","z":"b7f32e3b.86411","name":"night-reg","filename":"/home/debo/repos/anpr/public/result.json","appendNewline":true,"createDir":false,"overwriteFile":"false","encoding":"none","x":660,"y":100,"wires":[["2327afcb.db729"]]},{"id":"e2b6f81e.60c188","type":"template","z":"b7f32e3b.86411","name":"Web Template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n    <title>Licence Plate</title>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-timepicker/0.5.2/css/bootstrap-timepicker.min.css\" />\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js\"></script>\n    <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js\"></script>\n    <link type=\"text/css\" rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.css\" />\n    <link type=\"text/css\" rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid-theme.min.css\" />\n    <script type=\"text/javascript\" src=\"https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.js\"></script>\n\n    <script type=\"text/javascript\">\n        $(function () {\n            var db = {{#payload}}{{{.}}}{{/payload}};\n                $(\"#jsgrid\").jsGrid({\n                    width: \"100%\",\n                    inserting: true,\n                    editing: true,\n                    sorting: true,\n                    paging: true,\n\n                    data: db,\n\n                    fields: [\n                        { title:\"Registrations\", name: \"registration\", type: \"text\", width: 50 },\n                       \n                        { type: \"control\" }\n                    ],\n               \n                    controller: {\n                        insertItem: function(item) {\n                            return $.ajax({\n                                type: \"POST\",\n                                url: \"/insert\",\n                                data: item\n                            });\n                        },\n                        updateItem: function(item) {\n                           return $.ajax({\n                                type: \"PUT\",\n                                url: \"/update\",\n                                data: item\n                            });\n                        },\n                        deleteItem: function(item) {\n                            return $.ajax({\n                                type: \"DELETE\",\n                                url: \"/delete\",\n                                data: item\n                            });\n                        }\n                    }   \n                });\n            });\n    \n  </script>\n</head>\n<body class=\"container\">\n    <section class=\"row\">\n        \n        <div class=\"col-md-6\"></div>\n        <div class=\"col-md-6\" id=\"jsgrid\">\n        </div>\n    </section>\n</body>\n</html>\n\n","x":480,"y":160,"wires":[["4ceee8ae.687e28"]]},{"id":"f882ab18.9d2b88","type":"http in","z":"b7f32e3b.86411","name":"","url":"/plates","method":"get","upload":false,"swaggerDoc":"","x":70,"y":160,"wires":[["c81f5176.54e34"]]},{"id":"4ceee8ae.687e28","type":"http response","z":"b7f32e3b.86411","name":"","x":630,"y":160,"wires":[]},{"id":"3fff0117.e631fe","type":"json","z":"b7f32e3b.86411","name":"","property":"payload","action":"","pretty":false,"x":330,"y":160,"wires":[["e2b6f81e.60c188"]]},{"id":"c81f5176.54e34","type":"mongodb2 in","z":"b7f32e3b.86411","service":"_ext_","configNode":"20418120.23251e","name":"find","collection":"AlprResults","operation":"find.toArray","x":210,"y":160,"wires":[["3fff0117.e631fe"]]},{"id":"b267b08b.5ccea","type":"http in","z":"b7f32e3b.86411","name":"","url":"/insert","method":"post","upload":false,"swaggerDoc":"","x":70,"y":220,"wires":[["7508ff2b.ba7b7"]]},{"id":"8950cbe6.c6dd48","type":"function","z":"b7f32e3b.86411","name":"callback response","func":"/*\npour que la jsGrid soit rafraichie, \nil faut lui envoyer l'objet qui a été mis à jour\n*/\nmsg.payload=msg.req.body;\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":220,"wires":[["69cf86a6.87f158"]]},{"id":"69cf86a6.87f158","type":"http response","z":"b7f32e3b.86411","name":"","x":650,"y":220,"wires":[]},{"id":"7508ff2b.ba7b7","type":"mongodb2 in","z":"b7f32e3b.86411","service":"_ext_","configNode":"20418120.23251e","name":"save","collection":"AlprResults","operation":"save","x":250,"y":220,"wires":[["8950cbe6.c6dd48"]]},{"id":"34837651.537fca","type":"http in","z":"b7f32e3b.86411","name":"","url":"/delete","method":"delete","swaggerDoc":"","x":80,"y":280,"wires":[["59bce831.14c618"]]},{"id":"59bce831.14c618","type":"function","z":"b7f32e3b.86411","name":"extract _id","func":"msg._id=msg.payload._id;\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":280,"wires":[["a0e70f9c.1067d"]]},{"id":"a0e70f9c.1067d","type":"objectid","z":"b7f32e3b.86411","name":"_id","selectedProperty":"_id","x":390,"y":280,"wires":[["c1a7b896.9b2408"]]},{"id":"2a6e97a7.3faa78","type":"http response","z":"b7f32e3b.86411","name":"","x":690,"y":280,"wires":[]},{"id":"c1a7b896.9b2408","type":"mongodb2 in","z":"b7f32e3b.86411","service":"_ext_","configNode":"20418120.23251e","name":"delete","collection":"AlprResults","operation":"deleteOne","x":530,"y":280,"wires":[["2a6e97a7.3faa78"]]},{"id":"3c1e387.5da42c8","type":"file","z":"b7f32e3b.86411","name":"night-reg","filename":"/home/debo/repos/anpr/public/alprresult.json","appendNewline":true,"createDir":false,"overwriteFile":"false","encoding":"none","x":480,"y":20,"wires":[["cf50d8a1.36bbd8"]]},{"id":"20418120.23251e","type":"mongodb2","z":"","uri":"mongodb://127.0.0.1:27017/alpr","name":"alpr","options":"","parallelism":"-1"}]