[{"id":"3473addb.639d82","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"ca327a8a.9675f8","type":"http in","z":"3473addb.639d82","name":"beanstalked","url":"/plate","method":"post","upload":true,"swaggerDoc":"","x":70,"y":100,"wires":[["c330c28c.185ec"]]},{"id":"c330c28c.185ec","type":"function","z":"3473addb.639d82","name":"extract","func":"//msg.payload=msg.payload.results[0].plate.flat;\n\nvar plate={};\nplate.registration=msg.payload.results[0].plate;\nmsg.payload=plate;\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":100,"wires":[["54d06e32.ead0e"]]},{"id":"8ed0449.856c1b8","type":"debug","z":"3473addb.639d82","name":"msg","active":false,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","x":1170,"y":100,"wires":[]},{"id":"e55abd58.68b0a","type":"http response","z":"3473addb.639d82","name":"","statusCode":"","headers":{},"x":810,"y":20,"wires":[]},{"id":"36be6f37.0f849","type":"mongodb2 in","z":"3473addb.639d82","service":"_ext_","configNode":"bb71c4c3.d02148","name":"alprd-check","collection":"alprTemplate","operation":"findOne","x":590,"y":100,"wires":[["e55abd58.68b0a","b0dfaad1.0c16f8","8ed0449.856c1b8"]]},{"id":"54d06e32.ead0e","type":"json","z":"3473addb.639d82","name":"","property":"payload","action":"obj","pretty":false,"x":410,"y":100,"wires":[["36be6f37.0f849"]]},{"id":"b019a08b.07876","type":"template","z":"3473addb.639d82","name":"Web ","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n    <title>Licence Plate</title>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-timepicker/0.5.2/css/bootstrap-timepicker.min.css\" />\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js\"></script>\n    <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js\"></script>\n    <link type=\"text/css\" rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.css\" />\n    <link type=\"text/css\" rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid-theme.min.css\" />\n    <script type=\"text/javascript\" src=\"https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.js\"></script>\n\n    <script type=\"text/javascript\">\n        $(function () {\n            var db = {{#payload}}{{{.}}}{{/payload}};\n                $(\"#jsgrid\").jsGrid({\n                    width: \"100%\",\n                    inserting: true,\n                    editing: true,\n                    sorting: true,\n                    paging: true,\n\n                    data: db,\n\n                    fields: [\n                        { title:\"Registrations\", name: \"registration\", type: \"text\", width: 50 },\n                       \n                        { type: \"control\" }\n                    ],\n               \n                    controller: {\n                        insertItem: function(item) {\n                            return $.ajax({\n                                type: \"POST\",\n                                url: \"/insert\",\n                                data: item\n                            });\n                        },\n                        updateItem: function(item) {\n                           return $.ajax({\n                                type: \"PUT\",\n                                url: \"/update\",\n                                data: item\n                            });\n                        },\n                        deleteItem: function(item) {\n                            return $.ajax({\n                                type: \"DELETE\",\n                                url: \"/delete\",\n                                data: item\n                            });\n                        }\n                    }   \n                });\n            });\n    \n  </script>\n</head>\n<body class=\"container\">\n    <section class=\"row\">\n        \n        <div class=\"col-md-6\"></div>\n        <div class=\"col-md-6\" id=\"jsgrid\">\n        </div>\n    </section>\n</body>\n</html>\n\n","x":570,"y":400,"wires":[["6c70b62f.73b4e8"]]},{"id":"18837f07.b24061","type":"http in","z":"3473addb.639d82","name":"","url":"/plates","method":"get","upload":false,"swaggerDoc":"","x":130,"y":400,"wires":[["8306cf2c.05e5f"]]},{"id":"6c70b62f.73b4e8","type":"http response","z":"3473addb.639d82","name":"","x":730,"y":400,"wires":[]},{"id":"7ab2041d.093c9c","type":"json","z":"3473addb.639d82","name":"","property":"payload","action":"","pretty":false,"x":430,"y":400,"wires":[["b019a08b.07876"]]},{"id":"8306cf2c.05e5f","type":"mongodb2 in","z":"3473addb.639d82","service":"_ext_","configNode":"1e8016aa.285249","name":"http-out","collection":"alprTemplate","operation":"find.toArray","x":300,"y":400,"wires":[["7ab2041d.093c9c"]]},{"id":"c7c59c7d.1a91c","type":"http in","z":"3473addb.639d82","name":"","url":"/insert","method":"post","upload":false,"swaggerDoc":"","x":130,"y":460,"wires":[["fc7c4fff.c7fa"]]},{"id":"f431e97.f19c018","type":"function","z":"3473addb.639d82","name":"callback response","func":"/*\npour que la jsGrid soit rafraichie, \nil faut lui envoyer l'objet qui a été mis à jour\n*/\nmsg.payload=msg.req.body;\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":460,"wires":[["cdd6b89.aa3cd48"]]},{"id":"cdd6b89.aa3cd48","type":"http response","z":"3473addb.639d82","name":"","x":590,"y":460,"wires":[]},{"id":"fc7c4fff.c7fa","type":"mongodb2 in","z":"3473addb.639d82","service":"_ext_","configNode":"1e8016aa.285249","name":"save","collection":"alprTemplate","operation":"save","x":270,"y":460,"wires":[["f431e97.f19c018"]]},{"id":"1cb625d9.123d5a","type":"http in","z":"3473addb.639d82","name":"","url":"/delete","method":"delete","swaggerDoc":"","x":145,"y":523,"wires":[["50a10d61.858d34"]]},{"id":"50a10d61.858d34","type":"function","z":"3473addb.639d82","name":"extract _id","func":"msg._id=msg.payload._id;\nreturn msg;","outputs":1,"noerr":0,"x":315,"y":523,"wires":[["af533b57.992018"]]},{"id":"51b0683b.fd1cc8","type":"http response","z":"3473addb.639d82","name":"","x":755,"y":523,"wires":[]},{"id":"554768a9.56d368","type":"mongodb2 in","z":"3473addb.639d82","service":"_ext_","configNode":"1e8016aa.285249","name":"delete","collection":"alprTemplate","operation":"deleteOne","x":595,"y":523,"wires":[["51b0683b.fd1cc8"]]},{"id":"af533b57.992018","type":"objectid","z":"3473addb.639d82","name":"","selectedProperty":"_id","x":465,"y":523,"wires":[["554768a9.56d368"]]},{"id":"86ecb3d6.cbc03","type":"file","z":"3473addb.639d82","name":"reg-check","filename":"/home/anpr/repos/anpr/public/alprresult.json","appendNewline":true,"createDir":false,"overwriteFile":"false","encoding":"none","x":580,"y":220,"wires":[[]]},{"id":"25a4a3dd.5fdfbc","type":"http in","z":"3473addb.639d82","name":"","url":"/check","method":"get","upload":false,"swaggerDoc":"","x":110,"y":300,"wires":[["c12248c4.e11598"]]},{"id":"c12248c4.e11598","type":"mongodb2 in","z":"3473addb.639d82","service":"_ext_","configNode":"1e8016aa.285249","name":"http-out","collection":"regCheck","operation":"find.toArray","x":280,"y":300,"wires":[["5947937c.28cc8c"]]},{"id":"5947937c.28cc8c","type":"json","z":"3473addb.639d82","name":"","property":"payload","action":"","pretty":false,"x":410,"y":300,"wires":[["e5ca92fb.78403"]]},{"id":"e5ca92fb.78403","type":"template","z":"3473addb.639d82","name":"Web ","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n    <title>Licence Plate</title>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-timepicker/0.5.2/css/bootstrap-timepicker.min.css\" />\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js\"></script>\n    <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js\"></script>\n    <link type=\"text/css\" rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.css\" />\n    <link type=\"text/css\" rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid-theme.min.css\" />\n    <script type=\"text/javascript\" src=\"https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.js\"></script>\n\n    <script type=\"text/javascript\">\n        $(function () {\n            var db = {{#payload}}{{{.}}}{{/payload}};\n                $(\"#jsgrid\").jsGrid({\n                    width: \"100%\",\n                    inserting: true,\n                    editing: true,\n                    sorting: true,\n                    paging: true,\n\n                    data: db,\n\n                    fields: [\n                        { title:\"Registrations\", name: \"registration\", type: \"text\", width: 50 },\n                       \n                        { type: \"control\" }\n                    ],\n               \n                    controller: {\n                        insertItem: function(item) {\n                            return $.ajax({\n                                type: \"POST\",\n                                url: \"/insert\",\n                                data: item\n                            });\n                        },\n                        updateItem: function(item) {\n                           return $.ajax({\n                                type: \"PUT\",\n                                url: \"/update\",\n                                data: item\n                            });\n                        },\n                        deleteItem: function(item) {\n                            return $.ajax({\n                                type: \"DELETE\",\n                                url: \"/delete\",\n                                data: item\n                            });\n                        }\n                    }   \n                });\n            });\n    \n  </script>\n</head>\n<body class=\"container\">\n    <section class=\"row\">\n        \n        <div class=\"col-md-6\"></div>\n        <div class=\"col-md-6\" id=\"jsgrid\">\n        </div>\n    </section>\n</body>\n</html>\n\n","x":550,"y":300,"wires":[["34b27d11.499352"]]},{"id":"34b27d11.499352","type":"http response","z":"3473addb.639d82","name":"","x":710,"y":300,"wires":[]},{"id":"b0dfaad1.0c16f8","type":"function","z":"3473addb.639d82","name":"extract","func":"msg.payload=msg.payload.registration;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":930,"y":300,"wires":[["8ed0449.856c1b8"]]},{"id":"2eadc4f0.9706bc","type":"switch","z":"3473addb.639d82","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1120,"y":400,"wires":[[]]},{"id":"bb71c4c3.d02148","type":"mongodb2","z":"","uri":"mongodb://127.0.0.1:27017/alpr","name":"alpr","options":"","parallelism":"-1"},{"id":"1e8016aa.285249","type":"mongodb2","z":"","uri":"mongodb://127.0.0.1:27017/alpr","name":"alpr","options":"","parallelism":"-1"}]