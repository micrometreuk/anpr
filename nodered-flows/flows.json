[{"id":"b2e7f73e.f47168","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"24a9de5b.f7f352","type":"http in","z":"b2e7f73e.f47168","name":"beans","url":"/plate","method":"post","upload":true,"swaggerDoc":"","x":55,"y":80,"wires":[["c9ae2074.1d98d"]]},{"id":"c9ae2074.1d98d","type":"function","z":"b2e7f73e.f47168","name":"extract","func":"//msg.payload=msg.payload.results[0].plate.flat;\n\nvar plate={};\nplate.registration=msg.payload.results[0].plate;\nmsg.payload=plate;\nreturn msg;","outputs":1,"noerr":0,"x":176,"y":80,"wires":[["d3acbe38.5cd0a"]]},{"id":"7ece4728.14d128","type":"debug","z":"b2e7f73e.f47168","name":"msg","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","x":710,"y":80,"wires":[]},{"id":"a0f8a62f.903cf8","type":"http response","z":"b2e7f73e.f47168","name":"","statusCode":"","headers":{},"x":576,"y":80,"wires":[]},{"id":"6f4c4163.86527","type":"mongodb2 in","z":"b2e7f73e.f47168","service":"_ext_","configNode":"ddd3b117.678ae","name":"alprdb","collection":"alprTemplate","operation":"findOne","x":427,"y":80,"wires":[["a0f8a62f.903cf8","dbf760a6.5cafb"]]},{"id":"d3acbe38.5cd0a","type":"json","z":"b2e7f73e.f47168","name":"","property":"payload","action":"obj","pretty":false,"x":293,"y":80,"wires":[["6f4c4163.86527","dbf760a6.5cafb"]]},{"id":"e93000ab.b8136","type":"template","z":"b2e7f73e.f47168","name":"Web ","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n    <title>Licence Plate</title>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-timepicker/0.5.2/css/bootstrap-timepicker.min.css\" />\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js\"></script>\n    <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js\"></script>\n    <link type=\"text/css\" rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.css\" />\n    <link type=\"text/css\" rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid-theme.min.css\" />\n    <script type=\"text/javascript\" src=\"https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.js\"></script>\n\n    <script type=\"text/javascript\">\n        $(function () {\n            var db = {{#payload}}{{{.}}}{{/payload}};\n                $(\"#jsgrid\").jsGrid({\n                    width: \"100%\",\n                    inserting: true,\n                    editing: true,\n                    sorting: true,\n                    paging: true,\n\n                    data: db,\n\n                    fields: [\n                        { title:\"Registrations\", name: \"registration\", type: \"text\", width: 50 },\n                       \n                        { type: \"control\" }\n                    ],\n               \n                    controller: {\n                        insertItem: function(item) {\n                            return $.ajax({\n                                type: \"POST\",\n                                url: \"/insert\",\n                                data: item\n                            });\n                        },\n                        updateItem: function(item) {\n                           return $.ajax({\n                                type: \"PUT\",\n                                url: \"/update\",\n                                data: item\n                            });\n                        },\n                        deleteItem: function(item) {\n                            return $.ajax({\n                                type: \"DELETE\",\n                                url: \"/delete\",\n                                data: item\n                            });\n                        }\n                    }   \n                });\n            });\n    \n  </script>\n</head>\n<body class=\"container\">\n    <section class=\"row\">\n        \n        <div class=\"col-md-6\"></div>\n        <div class=\"col-md-6\" id=\"jsgrid\">\n        </div>\n    </section>\n</body>\n</html>\n\n","x":515,"y":233,"wires":[["3899d8c6.e14758"]]},{"id":"b2a50510.c0a8d8","type":"http in","z":"b2e7f73e.f47168","name":"","url":"/plates","method":"get","upload":false,"swaggerDoc":"","x":75,"y":233,"wires":[["33fbf331.25781c"]]},{"id":"3899d8c6.e14758","type":"http response","z":"b2e7f73e.f47168","name":"","x":675,"y":233,"wires":[]},{"id":"934ec433.516b18","type":"json","z":"b2e7f73e.f47168","name":"","property":"payload","action":"","pretty":false,"x":375,"y":233,"wires":[["e93000ab.b8136"]]},{"id":"33fbf331.25781c","type":"mongodb2 in","z":"b2e7f73e.f47168","service":"_ext_","configNode":"d4f42577.abb5b8","name":"out","collection":"alprTemplate","operation":"find.toArray","x":235,"y":233,"wires":[["934ec433.516b18"]]},{"id":"d8406af2.11dad8","type":"http in","z":"b2e7f73e.f47168","name":"","url":"/insert","method":"post","upload":false,"swaggerDoc":"","x":75,"y":310,"wires":[["8acd33ce.66648"]]},{"id":"cc471c50.2d99a","type":"function","z":"b2e7f73e.f47168","name":"callback response","func":"/*\npour que la jsGrid soit rafraichie, \nil faut lui envoyer l'objet qui a été mis à jour\n*/\nmsg.payload=msg.req.body;\nreturn msg;","outputs":1,"noerr":0,"x":385,"y":310,"wires":[["a0728169.4b894"]]},{"id":"a0728169.4b894","type":"http response","z":"b2e7f73e.f47168","name":"","x":570,"y":309,"wires":[]},{"id":"8acd33ce.66648","type":"mongodb2 in","z":"b2e7f73e.f47168","service":"_ext_","configNode":"d4f42577.abb5b8","name":"save","collection":"alprTemplate","operation":"save","x":225,"y":310,"wires":[["cc471c50.2d99a"]]},{"id":"6a2e1281.b93c9c","type":"http in","z":"b2e7f73e.f47168","name":"","url":"/delete","method":"delete","swaggerDoc":"","x":85,"y":358,"wires":[["6599f70b.8fb258"]]},{"id":"6599f70b.8fb258","type":"function","z":"b2e7f73e.f47168","name":"extract _id","func":"msg._id=msg.payload._id;\nreturn msg;","outputs":1,"noerr":0,"x":255,"y":358,"wires":[["e0bbf6c9.896128"]]},{"id":"c9b95d8c.53c62","type":"http response","z":"b2e7f73e.f47168","name":"","x":695,"y":358,"wires":[]},{"id":"4db7e7c3.e07ed8","type":"mongodb2 in","z":"b2e7f73e.f47168","service":"_ext_","configNode":"d4f42577.abb5b8","name":"delete","collection":"alprTemplate","operation":"deleteOne","x":535,"y":358,"wires":[["c9b95d8c.53c62"]]},{"id":"e0bbf6c9.896128","type":"objectid","z":"b2e7f73e.f47168","name":"","selectedProperty":"_id","x":405,"y":358,"wires":[["4db7e7c3.e07ed8"]]},{"id":"6850818b.513bf","type":"file","z":"b2e7f73e.f47168","name":"reg-out","filename":"/home/debo/repos/anpr/public/alprresult.json","appendNewline":true,"createDir":false,"overwriteFile":"false","encoding":"none","x":740,"y":20,"wires":[[]]},{"id":"dbf760a6.5cafb","type":"json","z":"b2e7f73e.f47168","name":"","property":"payload","action":"","pretty":false,"x":570,"y":20,"wires":[["7ece4728.14d128","6850818b.513bf"]]},{"id":"a01c924f.2d20e","type":"http in","z":"b2e7f73e.f47168","name":"","url":"/reg","method":"get","upload":false,"swaggerDoc":"","x":60,"y":160,"wires":[["dd8bf783.334af8"]]},{"id":"5c535c10.210214","type":"change","z":"b2e7f73e.f47168","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"application/json","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":160,"wires":[["27424902.98dda6"]]},{"id":"27424902.98dda6","type":"http response","z":"b2e7f73e.f47168","name":"","statusCode":"","headers":{},"x":710,"y":160,"wires":[]},{"id":"dd8bf783.334af8","type":"file in","z":"b2e7f73e.f47168","name":"alpr","filename":"/home/debo/repos/anpr/public/alprresult.json","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":210,"y":160,"wires":[["5c535c10.210214"]]},{"id":"ddd3b117.678ae","type":"mongodb2","z":"","uri":"mongodb://127.0.0.1:27017/alpr","name":"alpr","options":"","parallelism":"-1"},{"id":"d4f42577.abb5b8","type":"mongodb2","z":"","uri":"mongodb://127.0.0.1:27017/alpr","name":"alpr","options":"","parallelism":"-1"}]